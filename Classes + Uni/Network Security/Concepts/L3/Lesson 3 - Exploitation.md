{Your goal is to use the attached presentation to fill the lecture markdown. Your output should be in a markdown code block. Make notes brief, clear, and succinct over complicated and overly technical. I will use brackets to give further information as we go along}
{ Consider that  the Objectives are 
-  Understand the difficulty in stopping packet spoofing 
-  Explain and apply various techniques to exploit systems 
-  Understand how DNS works and describe the various DNS attacks in detail 
-  Be able to define basic metasploit terms 
-  Be able to exploit a basic vulnerability using metasploit }
![[Screenshot 2025-03-21 at 3.09.12 AM.jpg]]
# Notes
## Ingress Filtering vs Egress Filtering
### Ingress Filtering Upstream
1- bgp udpate
2- tier 1 filter all but what it got from bgp update
3- 56.56.0.1 is blocked
4- 34.34.0.1 gets through

why don't local isps implement ingress filtering while t1 isps have?

## Session Hijacking

details
reverse shell
Arp Cache poisoning
limitation

## Denial of Service
{Explain each of these like connection flooding, but still make these more organized and better}
### Vulnerability
### Connection Flooding
Mitigating Syn Flood:
- Connection Cache
- Syn Cookies (3way handshake):
	- When syn cookies are enabled, host will generate a syn cookie as a function of ip addresses, ports, slow time, and magic number), stuffs it in isnb and then if a connection was legitimate the syn cookie would come back in the ack from the host.  Only if the correct syn cookie is returned will a socket be opened.
	- tpc syn (seq ISN A random number, ack = 0) ->
	- tpc syn ack (seq ISN B (SYN Cookie) random number, ack = a+1) <-
	- tpc ack (seq a+1 random number, ack = ISN B + 1) -> 
### Bandwidth flooding
## IP Fragmentation and Vulnerabilities
### Land attack
### Ping of death
### Jolt2
### Teardrop, Newtear, Bonk, Syndrop...


# Lecture Notes: Vulnerabilities and Exploits

## Ingress vs. Egress Filtering

### Ingress Filtering Upstream
- **What It Is:**  
  - Filtering incoming packets at the ISP level based on BGP updates.
- **How It Works:**  
  1. Tier-1 ISPs receive BGP updates with valid IP ranges.
  2. They filter out any incoming packets that don’t match these updates.
  3. *Example:* Packets from 56.56.0.1 are blocked, while those from 34.34.0.1 get through.
- **Key Question:**  
  - Why don’t local ISPs implement this filtering?  
    *Local ISPs may lack the required infrastructure, policies, or incentives compared to Tier-1 providers.*

### Egress Filtering
- **What It Is:**  
  - Monitoring and controlling outgoing traffic to prevent spoofed packets from leaving the network.
- **Why It Matters:**  
  - Helps stop internal systems from being used to launch attacks.

---

## Session Hijacking

- **Definition:**  
  - Taking over an active TCP session by intercepting and spoofing traffic.
- **Key Techniques:**  
  - **Reverse Shell:** Gaining control by initiating a connection back to the attacker.
  - **ARP Cache Poisoning:** Sending false ARP replies to misdirect traffic.
- **Limitations/Challenges:**  
  - Sequence number mismatches can disrupt the session.
  - Effective defense requires encryption and strong authentication.

---

## Denial of Service (DoS)

### Vulnerability-Based Attacks
- **Description:**  
  - Exploiting bugs or misconfigurations with specially crafted messages to crash or disable services.

### Connection Flooding (SYN Flood) 
- **What It Is:**  
  - Overwhelming a server’s connection queue with a barrage of half-open TCP connections.
- **Mitigation Techniques:**  
  - **Connection Cache:** Temporarily stores pending connections.
  - **SYN Cookies:**  
    - **How They Work:**  
      1. On receiving a SYN, the server generates a "cookie" based on IP addresses, ports, a secret value, and time.
      2. This cookie is sent in the SYN-ACK’s sequence number.
      3. Only if the correct cookie is returned in the ACK does the server open a socket.
    - **TCP Flow:**  
      - **TCP SYN:** Client sends with random sequence number.  
      - **TCP SYN-ACK:** Server replies with syn cookie as its sequence, expecting ack = client_seq + 1.  
      - **TCP ACK:** Client completes handshake with ack = syn_cookie + 1.
      
### Bandwidth Flooding Distributed DDos Attack  AMPlification
- **What It Is:**  
  - Overloading a network’s bandwidth by sending massive amounts of traffic.
- **Effect:**  
  - Legitimate traffic gets starved, leading to service disruption.

---

## IP Fragmentation and Related Vulnerabilities

- **Land Attack:**  
  - Sends a spoofed packet where the source and destination IP (and port) are identical.
- **Ping of Death:**  
  - Uses oversized ICMP packets that exceed allowed limits, causing system crashes.
- **Jolt2:**  
  - Sends a stream of fragmented packets (none with offset 0) that overload the target’s reassembly process.
- **Teardrop, Newtear, Bonk, Syndrop:**  
  - Send overlapping IP fragments, confusing the reassembly process and potentially crashing the target.

---

## Metasploit and Nessus

### Metasploit
- **What It Is:**  
  - An open-source exploitation framework for penetration testing and vulnerability research.
- **Basic Workflow & Commands:**  
  - `use <exploit_path>`: Select an exploit module.  
  - `show options`: View required settings for the exploit.  
  - `set <option> <value>`: Configure target parameters (e.g., IP, port).  
  - `show payloads`: List payloads compatible with the selected exploit.  
  - `exploit`: Execute the exploit.  
  - `sessions -i <id>`: Interact with an active session.
- **Key Terms:**  
  - **Exploit:** Code that takes advantage of a vulnerability.
  - **Payload:** Code delivered by the exploit (e.g., a reverse shell).
  - **Encoder:** Obfuscates payloads to evade detection.
  - **Auxiliary Module:** Additional tools for scanning or post-exploitation tasks.
- **Tip:**  
  - Use reverse payloads to bypass firewall restrictions.
- **Resource:**  
  - *Metasploit Unleashed* – a free online guide for learning Metasploit.

### Nessus
- **What It Is:**  
  - A vulnerability scanner that identifies weaknesses in systems and networks.
- **Key Features:**  
  - Can perform both external (non-credentialed) and internal (credentialed) scans.
  - Generates detailed vulnerability reports.
- **Alternatives:**  
  - OpenVAS – an open-source fork of the original Nessus code.
- **Usage Note:**  
  - Regular scanning and proper configuration are crucial for accurate vulnerability detection.

# Network Security – Lecture Notes

## Objectives
- **Understand the difficulty in stopping packet spoofing**
- **Explain and apply various techniques to exploit systems**
- **Understand how DNS works and describe the various DNS attacks in detail**
- **Be able to define basic Metasploit terms**
- **Be able to exploit a basic vulnerability using Metasploit**

---

## Ingress Filtering vs. Egress Filtering
- **Ingress Filtering:**  
  - Blocks or restricts incoming packets whose source addresses are not from the networks they claim to be.  
  - Typically implemented by ISPs to prevent spoofed packets from entering the broader internet.

- **Egress Filtering:**  
  - Monitors outgoing traffic to ensure local systems do not send spoofed or malicious packets.  
  - Helps identify infected hosts within a network that might be sending harmful traffic.

### Ingress Filtering Upstream (Example from Slides)
1. **BGP Update:** The ISP learns which networks (e.g., 12.12.0.0/24) belong to which neighbors.  
2. **Tier-1 ISP Filters:** Allows only traffic matching the known BGP updates from each customer network.  
3. **Spoofed Address Blocked:** If a packet arrives with an address that doesn’t match the assigned block, it’s dropped.  
4. **Legitimate Packets Pass:** Correct addresses (e.g., 34.34.0.1) are accepted.

### Why Don’t Local ISPs Always Implement Ingress Filtering While Tier-1 ISPs Often Do?
- **Resource Overhead:** Smaller ISPs may lack the staffing and hardware to maintain strict filtering.  
- **Cost and Complexity:** Configuring and consistently updating filters can be cumbersome for smaller providers.  
- **Policy Variation:** Large Tier-1 ISPs typically have stronger peering agreements and regulations that require stringent filtering.

---

## Session Hijacking
- **Concept:** Taking control of an existing TCP session between two parties (e.g., user and server).  
- **Method:**  
  - **Sniffing:** Attacker must see the traffic (e.g., on the same LAN).  
  - **Spoofing:** Inject forged packets with the correct sequence numbers.  
  - **ARP Cache Poisoning:** Attacker can disrupt or block the legitimate client to avoid conflicting packets.  
- **Limitation:**  
  - If both legitimate client and attacker send data, the session can become unsynchronized, often alerting the server.

---

## Denial of Service (DoS)
Aimed at preventing legitimate users from accessing network services.

### Vulnerability Attacks
- **Send Crafted Messages:** Exploit a bug (e.g., buffer overflow) to crash the service with minimal traffic.

### Connection Flooding
- **SYN Flood:** Overwhelm a server’s half-open TCP connection queue.  
  - **Mitigation – SYN Cookies:**  
    - Server encodes connection details into its SYN/ACK packet.  
    - Doesn’t allocate resources until the final ACK confirms the cookie, thwarting floods of half-open connections.

### Bandwidth Flooding
- **High-Volume Traffic:** Overload the target’s bandwidth until legitimate traffic cannot pass.

---

## IP Fragmentation and Vulnerabilities
Attackers send abnormal or maliciously crafted fragments to crash or destabilize systems.

- **Land Attack:** Spoofed packet with identical source and destination (host attacks itself).  
- **Ping of Death:** Send oversized ICMP packets that exceed normal IP limits.  
- **Jolt2:** Stream of fragments that never complete properly, consuming CPU resources.  
- **Teardrop / Newtear / Bonk / Syndrop:** Send overlapping or invalid fragment offsets to confuse reassembly and crash targets.

---

## Metasploit and Nessus

### Nessus (Vulnerability Scanning)
- **Purpose:** Automates discovery of known vulnerabilities in networked systems.  
- **Key Features:**  
  - Scans open ports, identifies software/OS versions, and checks against vulnerability signatures.  
  - Provides detailed reports to guide remediation.

### Metasploit (Exploitation Framework)
- **Key Terms:**  
  - **Vulnerability:** Weakness in a system.  
  - **Exploit:** Code that leverages a vulnerability.  
  - **Payload:** The code (e.g., reverse shell) delivered by the exploit.  
  - **Encoders:** Obfuscate payloads to evade antivirus detection.  
- **Usage Steps:**  
  1. **Find/Select an Exploit** (e.g., `use exploit/windows/smb/ms08_067_netapi`).  
  2. **Choose and Configure Payload** (e.g., `set payload windows/meterpreter/reverse_tcp`).  
  3. **Set Options** (`set RHOST`, `set LHOST`, etc.).  
  4. **Exploit** (`exploit` command to run).  
- **Why Reverse Shells?**  
  - Bypass NAT/Firewalls by having the victim connect back to the attacker.  
- **Nessus + Metasploit:**  
  - Common workflow is to scan systems with Nessus, identify vulnerabilities, then launch targeted exploits in Metasploit.



DNS Amplification/Reflection Attack (DNS request is about 60-80 bytes but requesting a txt record leads to a 10x increase in response size because txt records are much bigger.)
NTP UDP port 123 attacks

How recursive DNS works.
What happens when an attacker manages to poison the cache of dns servers, and what advantages do you get on poisioning different steps in the recursive process? Like step 5 vs step 7.

For the attacker to do DNS cache poisoning they must:
- respond faster than the real dns server
- spoof the dns server ip address 
- use the same transaction id, port num from dns packet
How hard and easy are these when looking at the different levels? For example, when infecting a local dns cache, being faster than the real dns server is easy, but when tyring to attack a real dns server of like .com for example, then it's very hard and close to impossible.

What are the steps for a user to make a dns request for www.nytimes.com presuming no hosts have been on the internet?
step 1 from user to verizon, verizon to root server, verizon to .com, .com to verizon, verizon to nytimes.com, nytimes.com to verizon, verizon to host...

Suppose an attacker is on the users home network how hard is it to poison your dns cache? 
- respond faster than the real dns server -> easy
- spoof the ip address -> easy
- use the same transaction id and udp port number -> easy (you can see the packets)

suppose an attacker wants to poison the dns cache for all users on verizon fios and make all users who go to www.nytime.com go to 6.6.6.6? How would they do that? How hard is it?
- spoof step 5 of the diagram (could also be step 7)
- responding faster is super hard 
- spoofing ip is fairly easy
- since the packet is unreadable it's almost impossible to do the last step of getting the transaction id